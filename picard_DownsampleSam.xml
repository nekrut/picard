<tool name="Downsample SAM/BAM" id="picard_DownsampleSam" version="1.121.0">
  <!-- found on https://bitbucket.org/bwlang/galaxy-dist/src/ca5ded2e18a9ef802c31429e3cb861e8775b24d0/tools/picard/picard_DownsampleSam.xml -->
  <description>Down-sample a file to retain a subset of the reads</description>
  <requirements>
    <requirement type="package" version="1.121.0">picard</requirement>
  </requirements>
   
  <macros>
    <import>picard_macros.xml</import>
  </macros>
   
  <command>java -jar
    \$JAVA_JAR_PATH/DownsampleSam.jar
      INPUT="${inputFile}"
      OUTPUT="${outFile}"
      PROBABILITY=${probability}
      RANDOM_SEED=${seed}
      QUIET=true
      VERBOSITY=ERROR
      VALIDATION_STRINGENCY=${validation_stringency}
  </command>
  <inputs>
    <param format="sam,bam" name="inputFile" type="data" label="SAM/BAM dataset to be downsampled"
           help="If empty, upload or import a SAM or BAM dataset." />
    <param name="probability" type="float" size="5" label="Probability (between 0 and 1) that any given read will be kept" help="specify 1 to keep all reads, 0.1 to keep 10% of the reads" value="1" />
    <param name="seed" type="integer" size="5" label="Random seed value" help="(same seed + same probability = same set of reads kept)" value="1" />
    
    <expand macro="VS" />
    
  </inputs>
  
  <outputs>
    <data name="outFile" format="bam" label="${tool.name} on ${on_string}: downsampled BAM"/>
  </outputs>
  
  <stdio>
        <regex match="Finished" source="both" level="warning" />
  </stdio>
  
  <tests>
    <test>
      <param name="inputFile" value="picard_DownsampleSam.bam"  ftype="bam" />
      <param name="probability" value="0.1" />
      <param name="seed" value="1024" />
      <param name="validation_stringency" value="LENIENT" />
      <output name="outFile" file="picard_DownsampleSam_test1.bam" ftype="bam"/>
    </test>
  </tests>
  <help>

.. class:: infomark

**Purpose**

Randomly down-sample a SAM or BAM file to retain a random subset of the reads. Mate-pairs are either both kept or both discarded. Reads marked as not primary alignments are all discarded. Each read is given a probability P of being retained - results with the exact same input in the same order and with the same value for RANDOM_SEED will produce the same results.

@description@

  INPUT=File
  I=File              The input SAM or BAM file to downsample.  Required. 

  OUTPUT=File
  O=File              The output, downsampled, SAM or BAM file to write.  Required. 

  RANDOM_SEED=Long
  R=Long              Random seed to use if reproducibilty is desired.  Setting to null will cause multiple
                      invocations to produce different results.
                      
  PROBABILITY=Double
  P=Double            The probability of keeping any individual read, between 0 and 1. 
                       


@more_info@
  </help>
</tool>
